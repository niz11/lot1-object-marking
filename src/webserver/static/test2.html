<!DOCTYPE html>
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
<title>Hello, AR Cubes!</title>
<!-- include three.js library -->
<script src='old/three.js'></script>
<!-- include jsartookit -->
<script src="jsartoolkit5/artoolkit.min.js"></script>
<script src="jsartoolkit5/artoolkit.api.js"></script>
<!-- include threex.artoolkit -->
<script src="threex/threex-artoolkitsource.js"></script>
<script src="threex/threex-artoolkitcontext.js"></script>
<script src="threex/threex-arbasecontrols.js"></script>
<script src="threex/threex-armarkercontrols.js"></script>

<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

<!--
  Example created by Lee Stemkoski: https://github.com/stemkoski
  Based on the AR.js library and examples created by Jerome Etienne: https://github.com/jeromeetienne/AR.js/
-->

<script>


    var arToolkitSource, arToolkitContext;

    initialize();
    animate();

    function initialize()
    {


        arToolkitSource = new THREEx.ArToolkitSource({
            sourceType : 'webcam',
            displayWidth: window.innerWidth,
            displayHeight: window.innerHeight
        });

        arToolkitSource.init(function onReady(){
            onResize()
        })

        // handle resize
        window.addEventListener('resize', function(){
            onResize()
        })
        function onResize(){
            arToolkitSource.onResizeElement()
            if( arToolkitContext.arController !== null ){
                arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas)
            }
        }

        window.addEventListener("markerFound", function (e) {
            console.log("Found")
            console.log(e.detail);
        });
        window.addEventListener("markerLost", function (e) {
            console.log("Lost")
            console.log(e.detail);
        });

        arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'data/camera_para.dat',
            detectionMode: 'mono',
            // canvasWidth: 80*3,
            // canvasHeight: 60*3,
            // maxDetectionRate: 30
        });

        arToolkitContext.init( function onCompleted(){
        });

        let patternArray = ["letterA", "letterB", "letterC", "letterD", "letterF", "kanji", "hiro"];
        for (let i = 6; i < 7; i++)
        {
            let markerRoot = new THREE.Group();
            let markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
                type : 'pattern', patternUrl : "data/" + patternArray[i] + ".patt",
            });
        }
        onResize()
    }


    function update()
    {
        if ( arToolkitSource.ready !== false )
            arToolkitContext.update( arToolkitSource.domElement );
    }

    function animate()
    {
        requestAnimationFrame(animate);
        update();
    }

</script>

</body>
</html>